{{- $architecture := or .architecture "arm64" -}}
{{- $image := or .image (printf "mobian-android9-%s.tar.gz" $architecture) -}}
{{- $suite := "bullseye" -}}
{{- $output_type := "tarball" -}}

architecture: {{ $architecture }}
actions:

  - action: debootstrap
    suite: {{ $suite }}
    components:
      - main
    mirror: https://deb.debian.org/debian
    variant: minbase

  - action: overlay
    source: overlays/mobian
    description: Adding mobian overlay
    destination: /

  - action: overlay
    source: overlays/hybris-mobian
    description: Adding hybris-mobian overlay
    destination: /

  - action: run
    chroot: true
    description: update apt
    command: apt update

  - action: apt
    chroot: true
    description: install packages
    packages:
      - mobian-phosh

  - action: run
    chroot: true
    description: add mobian user
    script: scripts/setup_user.sh

  - action: run
    chroot: true
    description: set hostname and generate locale
    script: scripts/setup_system.sh
