{{- $architecture := or .architecture "arm64" -}}

architecture: {{ $architecture }}
actions:

  - action: recipe
    description: create rootfs
    recipe: generic_minimal.yaml
    variables:
      architecture: {{ $architecture }}

  - action: overlay
    source: overlays/phoc-staging
    description: Adding phoc-staging repo
    destination: /

  - action: overlay
    source: overlays/phosh-staging
    description: Adding phosh-staging repo
    destination: /

  - action: run
    chroot: true
    description: update apt
    command: apt update

  - action: apt
    chroot: true
    description: install adaption-hybris
    packages:
      - adaptation-hybris-api28

  - action: run # TMP
    description: installing phosh and phoc from staging repositories
    chroot: true
    command: apt install -y --allow-downgrades phosh phoc

  - action: run
    description: Set up android
    chroot: true
    script: scripts/setup-api28gsi.sh


